<html>
<head>
    <title>D3.js Graph Editor</title>

    <script type="text/javascript" src="lib/jquery-2.1.3.js"></script>
    <script type="text/javascript" src="lib/d3.min.js"></script>
    <script type="text/javascript" src="graphEditor.js"></script>
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <h1>D3.js Graph Editor</h1>
    </p>
    <div id="graphEditor"></div>

    <script type="text/javascript">
        $(function(){

            d3.json("data.json", function(data){

                //complex data
                var i=0;
                data.nodes.forEach(function(entry){
                    entry.id = ++i;
                });

                data.links.forEach(function(entry){
                    data.nodes.forEach(function(node){
                        if(node.id === entry.source)
                            entry.source = node;
                        if(node.id === entry.target)
                            entry.target = node;
                    });
                });

                //inital data
                var nodes = [
                    {id: 0, reflexive: false},
                    {id: 1, reflexive: true },
                    {id: 2, reflexive: false}
                ];

                var links = [
                    {source: nodes[0], target: nodes[1], left: false, right: true },
                    {source: nodes[1], target: nodes[2], left: false, right: true }
                ];

                //reload data
                var newnodes = [
                    {id: 1, test:"test", reflexive: false},
                    {id: 1, reflexive: true }
                ];

                var newlinks = [
                    {source: newnodes[0], target: newnodes[1], left: false, right: true }
                ];

                function onAddNode(node){
                    console.log("A node was added!");
                }

                function onAddLink(link){
                    console.log("A link was added!");
                }

                //testing
                var editor = new GraphEditor("#graphEditor",  {nodes : nodes, links : links, lastNodeID : 2, onAddNode : onAddNode, onAddLink : onAddLink});

                //reload test
                setTimeout(function(){
                    editor.reload({nodes: newnodes, links: newlinks, lastNodeID : 1});
                }, 3000);

                //var editor = new GraphEditor("#graphEditor",  {nodes : data.nodes, links : data.links, lastNodeID : i});

            });
        });
    </script>

</body>
</html>
